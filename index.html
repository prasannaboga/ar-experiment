<html>
  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>AR</title>
    <style>
      html, body, canvas {
        margin:     0;
        padding:    0;
        width:      100%;
        height:     100%;
        text-align: center;
        overflow:   hidden
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <footer>
      Please enable the camera!
    </footer>
    <script src="artoolkit.min.js"></script>
    <script src="three.min.js"></script>
    <script src="artoolkit.three.js"></script>
    <script>
      // AR related code.
      if (window.ARController && ARController.getUserMediaThreeScene) {
        ARThreeOnLoad();
      }

      function ARThreeOnLoad() {
        ARController.getUserMediaThreeScene({
          maxARVideoSize: 640,
          cameraParam:    'camera_para.dat',
          onSuccess:      createAR
        });
      }

      function createAR(arScene, arController, arCamera) {
        arController.setPatternDetectionMode(artoolkit.AR_MATRIX_CODE_DETECTION);

        // The dom element inside which to place the camera.
        var root = document.getElementById("root");

        // Creates a font loader.
        var loader = new THREE.FontLoader()

        // Call a function when the font is loaded.
        loader.load('droid_sans_mono_regular.typeface.json', startAnimation);

        // Start to animate.
        function startAnimation(font) {
          // Creates a scene.
          var scene = new THREE.Scene()

          // Creates the renderer and appends it to the DOM.
          var renderer = new THREE.WebGLRenderer({antialias: true});
          renderer.setSize(window.innerWidth, window.innerHeight)
          root.appendChild(renderer.domElement)

          var markerRoot = arController.createThreeBarcodeMarker(20);

          // Creates the text.
          var geometry = new THREE.TextGeometry('AR', {
            font:   font,
            size:   1,
            height: 0.1
          })
          var material = new THREE.MeshBasicMaterial({color: 0xffa500})

          var text = new THREE.Mesh(geometry, material)
          text.material.shading = THREE.FlatShading;
          text.position.z = 0

          // Adds the text to the marker.
          markerRoot.add(text);

          // Adds the master to the sceene.
          arScene.scene.add(markerRoot);

          var tick = function() {
            arScene.process();
            arScene.renderOn(renderer);
            requestAnimationFrame(tick);
          };

          tick();
        }
      }
    </script>
  </body>
</html>
